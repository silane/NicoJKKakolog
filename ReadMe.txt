========================================================

NicoJKKakolog

    TVTest ニコニコ&2chコメント表示プラグイン

========================================================

# 利用は自己責任で行ってください
# このプラグインはニコニコ実況サーバや2chのサーバーと通信します。サーバに高負荷を与えるような利用や改変をしないでください。


■なにこれ？
ニコニコ実況をTVTestで表示する自分用のプラグインです。tvtplayで録画tsファイルを再生すると自動的にニコニコ実況から過去ログをとってきて流せること、2chのスレのコメントを流せることが特徴です。NicoJKPlayModから改造して作りましたが、動かなくなってる機能も多いのでNicoJKPlayModの上位互換ではありません。これから機能追加するかもしれませんが、あくまでも自分（作者）用だと思ってください。


■改造元のNicoJKについて
このソフトはNicoJKPlayMod修正18から改造しました。このプラグインはどうやらNicoJKに取り込まれていたようですが、私が知らなかったのであくまでもNicoJKPlayMod修正18からの改造です。なので死んでる機能が多い上にさらに元からの機能も少ないかも・・・


■機能
・現在のニコニコ実況のコメントを流す
・録画ファイルに対応するニコニコ実況過去ログを自動でダウンロードして流す
・実況の過去ログファイルからコメントを読み込んで流す（未完成、■制限参照）
・2chのスレのレスを流す(１度スレを選択すると似た名前のスレを選択し続けます)


■導入方法
0)入ってなければMicrosoft Visual C++ 2015 再頒布可能パッケージをインストールする
1)NicoJKKakolog.tvtp、NicoJKKakolog.iniをTVTestのPluginフォルダにいれる
2)cpprest140_2_8.dllをTVTest.exeのあるフォルダにいれる（←#########重要！###########）
3)過去ログ表示をしたい場合はNicoJKKakolog.iniにニコニコのアカウント情報を入れる


■NicoJKKakolog.iniについて
・改造元のNicoJKPlayModの設定は使えるものもありますが、描画系以外の割と多くの項目が機能を果たさなくなっていますのであしからず。


■使い方
1)TVTestでこのプラグインを有効にする
2)出てきたウィンドウの「チャット元」ボタンを押し、どこからコメントをとってくるかチェックボックスで選ぶ
3)コメントの表示を進めたり遅らせたりしたい場合は「<」や「>」ボタンを押すと0.5秒ずつずれる。元に戻すには「=」ボタンを押す。（現在のコメントには効果なし）


■NG機能
・NicoJKのダイアログのNGボタンを押すとNG設定ダイアログが出るのでそこからNGID,NGWordの追加、削除を行う
・このダイアログはモードレスなので表示したまま他のウィンドウを操作できる
・NicoJKのダイアログのログリストをダブルクリックすることでもNGIDを追加できる



■コマンドライン引数
/jkchatsrc     デフォルトでオンにするチャット元の名前を指定する (例 /jkchatsrc ニコニコ実況過去ログ,ニコニコ実況ファイル読み込み)
/jkdlgview     デフォルトでダイヤログに何を表示するか 設定値: trend,log,chatselect (例 /jkdlgview trend)


■バグ
・実況ファイル読み込みのチェックボックスをチェックした後、数１０秒以内に戻すとクラッシュ
・2chコメント表示関連がフリーズすることが多い
・たまに起動直後からニコニコ実況過去ログが一切表示されない（TVTestを再起動すれば直ります）


■制限
・コメントはできません。
・ドラックアンドドロップでの過去ログファイル読み込みはできません
・特定のフォルダから自動で過去ログファイルを読み込む機能はありません
・切断時や４時の実況切り替わり時の再接続は未実装。
・コメントファイルからの読み込みは未完成（番組開始からの相対時刻でなく絶対時刻でコメントを表示する、つまり再放送で元放送のファイルは使えない＆開始時刻を調整できない）
・過去ログ取得機能を使うとブラウザなどの他の場所のニコニコアカウントはログアウトされる（同時に使いたい場合は別アカ取ってください）
・2chのコメントが団子になる&遅延が大きい（2chのサーバーの仕様っぽいので仕方ない）
・NG設定ダイアログのNG一覧のリストの選択状態が8秒ごとにリセットされる


■開発者向け
・GitHubリポジトリ -> https://github.com/silane/NicoJKKakolog
・このソフトはVisual Studio 2015 Communityで作りました。C++11のサポートが必須です。
・このソフトはRestSDKを使っています。cpprest140_2_8.dllがそれです。ビルドするときはNugetからRestSDKをソリューションに追加してください。
・このソフトはlibxml2とその前提、libiconvを使っています。ビルドするときは自分で用意してください。
・コードを整理してコメント取得元を簡単に増やせるようになってます（例えばtwitterとか他形式の過去ログファイルとか）。具体的には特定のクラスを継承したクラスのインスタンスをNicoJKKakologに登録する感じで増やせます。したい人はコードを解読して増やしてください（投げやり）。ChatProviderとChatProviderEntryとNicoJKKakologクラスだけ見ればよいと思う。
・この整理の過程で死んでいていらないコードがたくさん残ってます。

■ライセンス
LICENSE.txt参照


■謝辞
このソフトはNicoJKPlayModから改造して作られました。NicoJKPlayModとNicoJKの作者様への感謝をここに表します。私はwin32プログラミングはほとんどできないので元のプログラムがなければ決して作れませんでした。ありがとうございます。


■更新履歴
初版(2016-4-21)

rev 1 (2016-4-23)
    コメントを進める/戻すボタンを付けた
    NicoJK.iniの[Channels]設定に対応した（たぶん）
    「チャット元」のチェックボックスを外した時やプラグイン終了時に発生する実行時エラーを修正した
    「ログ」ボタンを消した

rev 1.1 (2016-4-29)
    日本語ファイル名の実況ファイルの読み込み時のクラッシュを直した
    実況ファイル読み込みに失敗したときに無限ループでスレッドが終了しないのを直した

rev 2.0 (2016-7-5)
    2ch表示に対応した
    過去ログのチェックをするごとにニコニコに再ログインするようにした

rev 2.1 (2016-7-11)
    BSの自動過去ログ取得ができないのを修正
    自動過去ログ取得でサーバーが約10秒以内に応答しないとクラッシュしたりする問題を修正
    2chのスレ取得の間隔を1秒未満にできないようにした

rev 2.2 (2016-7-23)
    コマンドライン引数でデフォルトでオンにするチャット元を指定できるようにした
    自動過去ログ取得でサーバーが約10秒以内に応答しないとクラッシュしたりする問題を修正（今度こそ）

rev 2.3 (2016-7-30)
    プラグイン名、ファイル名、設定ファイル名をNicoJKKakologに変更
        設定ファイルは従来のNicoJK.iniでも動きます
    rev1で消したログ一覧を追加
    2chの類似スレ選択が間違っていたのを修正

rev 3.0 (2016-8-24)
    Windows XPが動作環境から外れた
    ライブラリを自作のに置き換えたのでライセンスをMITに変更した
    単語NG,ユーザーNG機能を付けた
    勢いリストからチャンネルを切り替えられるように
    ダイアログにデフォルトで何を表示するかコマンドラインで指定できるようにした
    改造元のコードにより現在のニコニコ実況がチェックボックスに関係なく表示されていたのをなくした
    現在のニコニコ実況のチェックボックスを切ると次にコメントが来るまで固まっていたのを修正
    コメント透過度のスライダーがおかしかったのを修正
    2chスレ選択ダイアログのスレリスト内の順序を保持するように
    2chスレ選択アルゴリズム修正

rev 3.1 (2016-8-28)
    上下コメ色コメNG機能を付けた
    現在のニコニコ実況で同じコメントが2重3重に表示されるのを修正

rev 3.2 (2016-9-13)
    色コメNG機能を付けた
    ニコニコ実況過去ログで過去にシークしたときコメントが表示されなくなることがあるのを修正
    ニコニコ実況過去ログでサーバーが応答しない時に大体の場合10秒でエラーを表示するように
    ニコニコ実況で一部のコメントの色が黒色になっていたのを修正

rev 3.3 (2017-3-10)
    https://www.axfc.net/u/3784806
    ニコニコ実況過去ログが表示されなくなったのを修正
