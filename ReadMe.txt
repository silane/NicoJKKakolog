========================================================

NicoJKKakolog

    TVTest コメント表示プラグイン

========================================================

# 利用は自己責任で行ってください
# このプラグインはニコニコ実況サーバ(jk.nicovideo.jp)と通信します。サーバに高負荷を与えるような利用や改変をしないでください。


■なにこれ？
ニコニコ実況をTVTestで表示する自分用のプラグインです。tvtplayで録画tsファイルを再生すると、自動的にニコニコ実況から過去ログをとってきて流せるのが特徴です。NicoJKPlayModから改造して作りましたが、動かなくなってる機能も多いのでNicoJKPlayModの上位互換ではありません。これから機能追加するかもしれませんが、あくまでも自分（作者）用だと思ってください。


■改造元のNicoJKについて
このソフトはNicoJKPlayMod修正18から改造しました。このプラグインはどうやらNicoJKに取り込まれていたようですが、私が知らなかったのであくまでもNicoJKPlayMod修正18からの改造です。なので死んでる機能が多い上にさらに元からの機能も少ないかも・・・


■機能
・現在のニコニコ実況のコメントを流す
・録画ファイルに対応するニコニコ実況過去ログを自動でダウンロードして流す
・実況の過去ログファイルからコメントを読み込んで流す（未完成、■制限参照）


■導入方法
0)入ってなければMicrosoft Visual C++ 2015 再頒布可能パッケージ(x86)をインストールする
1)NicoJK.tvtp、NicoJK.iniをTVTestのPluginフォルダにいれる
2)cpprest140d_2_8.dllをTVTest.exeのあるフォルダにいれる（←#########重要！###########）
3)過去ログ表示をしたい場合はNicoJK.iniにニコニコのアカウント情報を入れる


■NicoJK.iniについて
・NicoJK.iniに追加した設定項目は上述のニコニコアカウントの欄だけです。ほかの項目は使えるものもありますが、描画系以外の割と多くの項目が機能を果たさなくなっていますのであしからず。
・同封したNicoJK.iniは改造元のコンフィグは入っていないので、自分でコピーしてください。


■使い方
1)TVTestでこのプラグインを有効にする
2)出てきたウィンドウの「チャット元」ボタンを押し、どこからコメントをとってくるかチェックボックスで選ぶ
3)コメントの表示を進めたり遅らせたりしたい場合は「<」や「>」ボタンを押すと0.5秒ずつずれる。元に戻すには「=」ボタンを押す。（現在のコメントには効果なし）


■バグ
・割とたまにコメントが出ないときがあるのでその時はチェックボックスを戻してもう一回チェックしてください。それでも出ない場合は再起動をお願いします。
・コメントの色がおかしいことがある？
・実況ファイル読み込みのチェックボックスをチェックした後、数１０秒以内に戻すとクラッシュ


■制限
・コメントはできません。
・ドラックアンドドロップでの過去ログファイル読み込みはできません
・特定のフォルダから自動で過去ログファイルを読み込む機能はありません
・切断時や４時の実況切り替わり時の再接続は未実装。
・コメントファイルからの読み込みは未完成（番組開始からの相対時刻でなく絶対時刻でコメントを表示する、つまり再放送で元放送のファイルは使えない＆開始時刻を調整できない）
・過去ログ取得機能を使うとブラウザなどの他の場所のニコニコアカウントはログアウトされる（同時に使いたい場合は別アカ取ってください）


■開発者向け
・このソフトはVisual Studio 2015 Communityで作りました。C++11のサポートが必須です。
・このソフトはRestSDKを使っています。cpprest140d_2_8.dllがそれです。ビルドするときはNugetからRestSDKをソリューションに追加してください。
・コードを整理してコメント取得元を簡単に増やせるようになってます（例えば2chとかtwitterとか他形式の過去ログファイルとか）。具体的には特定のクラスを継承したクラスのインスタンスをNicoJKKakologに登録する感じで増やせます。したい人はコードを解読して増やしてください（投げやり）。ChatProviderとChatProviderEntryとNicoJKKakologクラスだけ見ればよいと思う。
・この整理の過程で死んでいていらないコードがたくさん残ってます。

■ライセンス
LICENSE.txt参照


■謝辞
このソフトはNicoJKPlayModから改造して作られました。NicoJKPlayModとNicoJKの作者様への感謝をここに表します。私はwin32プログラミングはほとんどできないので元のプログラムがなければ決して作れませんでした。ありがとうございます。


■更新履歴
初版(2016-4-21)

rev.1 (2016-4-23)
    http://www1.axfc.net/u/3655910
    コメントを進める/戻すボタンを付けた
    NicoJK.iniの[Channels]設定に対応した（たぶん）
    「チャット元」のチェックボックスを外した時やプラグイン終了時に発生する実行時エラーを修正した
    「ログ」ボタンを消した

rev.1.1 (2016-4-29)
    http://www1.axfc.net/u/3658275
    日本語ファイル名の実況ファイルの読み込み時のクラッシュを直した
    実況ファイル読み込みに失敗したときに無限ループでスレッドが終了しないのを直した