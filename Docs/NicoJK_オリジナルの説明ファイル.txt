/*
 NicoJK
  TVTest ニコニコ実況プラグイン
*/

■なにこれ？
ニコニコ実況をTVTestで表示するプラグインです。

■必要なもの
TVTestとチューナー

ニコニコ実況のSDKはとりあえず要らなくなりました。
useSDK=1としてニコニコ実況のSDKによる表示が良い場合は、
http://help.nicovideo.jp/jksdk/
からダウンロードして、インストールしてください。

■使い方
NicoJK.ini、NicoJK.tvtpをTVTestのPluginsフォルダに入れて、
TVTestを起動して、プラグインを有効にしてください。

■設定
NicoJK.iniで、
　「TVTestでのチャンネル名」
　と
　「ニコニコ実況の番号 （jk?の数字部分）」
を設定します。
デフォルトでは関東地域と難視聴チャンネルとＢＳが設定されています。

その他は直接NicoJK.iniを見てください

■制限
コメントはできません。
ニコニコ実況SDKを使わない場合、今のところbig/small/ueコマンドは解釈しません。
ＡＡは勝手に解体されます。
切断時や４時の実況切り替わり時の再接続は未実装。

■DirectWriteについて
Windows Vista以降かつ、DirectX 10.1以降対応のグラボがある環境で使用できます。
有効にするには disableDWrite=0 としてください。
有効になっていると、文字が縁取って表示されます。

■テスト環境
Win7 sp1 + PT2 + ptTimer + BonDriver_ptmr.dll + TVTest 0.7.19(x86)

■配布
https://github.com/rutice/NicoJK/downloads
リンクする場合は、配布ページか、ソースコードのページへお願いします。

■ソースコード
https://github.com/rutice/NicoJK

■更新履歴
rev.13
コメント設定をini設定可能にする変更をマージ
勢い一覧を取得するAPIを変更。ＢＳも表示するようにした。
DirectWriteをデフォルトでは使用しないようにした（iniで設定可）
勢いウィンドウを表示しない設定を追加（hideForceWindow）。
勢いウィンドウから同チャンネルの別サービスに切り替えできなかったのを修正。
大きなディスプレイの場合にコメントが切れる／表示できないのを修正（したはず）。

rev.12
DirectWriteが使える環境では使ってみた
新ＢＳチャンネルを追加した

rev.11
コメントの表示タイミングを改善した（行が溢れない限り重ならなくなった）
shitaコメントの表示が切れてたのを修正した

rev.10
コメントを描画するウィンドウの制御方法を変更した
画面サイズに応じてフォントサイズを自動で変えるようにした
勢い窓のフォントをちょっと大きくした
コメントの描画がされない環境があったのを修正した・・・はず

rev.9
コメントログを追加した
ついでに文字をちっさくし、ウィンドウをリサイズできるようにした
透過色を変えてみた
TVTestの「常に前面に表示」が効かないのを直した・・・はず

rev.8
独自実装によるコメント取得・描画をデフォルトで有効にした
　色とshitaコマンドには対応した。
　勢い取得も独自になった。BSは提供されてないので表示できません。
　useSDK=1とすると、以前のようにSDKを使って表示します。
TVTestをアクティブにすると、勢い窓も見えるようにした
勢い窓で現在見てるチャンネルを選択状態にした
独自実装で半角の><&"が表示されないのを修正

rev.7
独自実装でＢＳの実況も見れるようになった
useSDK=0とすると、地デジでも独自実装で見れるようになった
勢い窓の位置を保存するようにした

rev.6
コメントの位置調整方法を変えた（わりと決め打ちに）

rev.5
コメントの勢いを見れるウィンドウを実装

rev.4
プラグインを切っても起動時やチャンネル切替時にコメントが表示されたのを修正
ドライバ切替時にはすぐコメントを消すようにした

rev.3
難視聴のチャンネル名、通常のサービス名をNicoJK.iniに追加
TVTestへの追尾方法を変更（全画面表示・最前面表示だとまだ微妙におかしいけど）
サービス切替時にコメントが変更されないのを修正
実況のないチャンネルに切替してもコメントが消えなかったのを修正

rev.2
チャンネル設定対応
全画面対応

rev.1
初期リリース